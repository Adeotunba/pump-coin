<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>pump.coin â€” Mint Guardian</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.js"></script>
  <script type="module">
    import { getMint } from "https://cdn.jsdelivr.net/npm/@solana/spl-token@0.4.7/dist/index.browser.esm.min.js";
    import { PROGRAM_ID as TM_PROGRAM_ID } from "https://esm.sh/@metaplex-foundation/mpl-token-metadata@2.10.6";

    const { Connection, PublicKey } = solanaWeb3;
    const $ = (id)=>document.getElementById(id);
    const net = localStorage.getItem("network") || "devnet";
    const rpc = net === "devnet" ? "https://api.devnet.solana.com" : "https://api.mainnet-beta.solana.com";
    const conn = new Connection(rpc, "confirmed");

    function mdPdaFor(mintPk){
      return PublicKey.findProgramAddressSync(
        [Buffer.from("metadata"), TM_PROGRAM_ID.toBuffer(), mintPk.toBuffer()],
        TM_PROGRAM_ID
      )[0];
    }

    function grade({ mintAuthority, freezeAuthority, metadataExists }){
      // Simple rubric:
      // A: mintAuthority=null AND freezeAuthority=null AND metadataExists
      // B: mintAuthority=null AND (freezeAuthority!=null OR !metadataExists)
      // C: mintAuthority!=null
      if (mintAuthority !== null) return { letter: "C", note: "Mint authority still present (can mint more)." };
      if (freezeAuthority !== null || !metadataExists) return { letter: "B", note: "Consider renouncing freeze and ensuring metadata is set." };
      return { letter: "A", note: "Good: mint & freeze renounced, metadata present." };
    }

    async function runCheck(mintStr){
      const mintPk = new PublicKey(mintStr);
      const mdPda = mdPdaFor(mintPk);

      const info = await getMint(conn, mintPk);
      const mdAcc = await conn.getAccountInfo(mdPda);

      const mintAuthority = info.mintAuthority ? info.mintAuthority.toBase58() : null;
      const freezeAuthority = info.freezeAuthority ? info.freezeAuthority.toBase58() : null;
      const metadataExists = !!mdAcc;

      const g = grade({ mintAuthority, freezeAuthority, metadataExists });

      return {
        network: net,
        mint: mintPk.toBase58(),
        supply: info.supply.toString(),
        decimals: info.decimals,
        mintAuthority,
        freezeAuthority,
        metadataPda: mdPda.toBase58(),
        metadataExists,
        grade: g.letter,
        note: g.note,
        links: {
          explorer: `https://explorer.solana.com/address/${mintPk.toBase58()}?cluster=${net}`,
          metadataPda: `https://explorer.solana.com/address/${mdPda.toBase58()}?cluster=${net}`
        }
      };
    }

    async function handleCheck(){
      const mintStr = ($("mint").value||"").trim();
      if (!mintStr) return alert("Enter a token mint.");
      try {
        $("out").textContent = "Checkingâ€¦";
        const r = await runCheck(mintStr);
        $("out").textContent = JSON.stringify(r, null, 2);
        $("out").classList.remove("hidden");

        // Badge UI
        $("badge").textContent = r.grade;
        $("note").textContent = r.note;
        $("ex").href = r.links.explorer;
        $("md").href = r.links.metadataPda;
        $("gradeWrap").classList.remove("hidden");
      } catch (e){
        console.error(e);
        $("out").textContent = "Failed to check mint â€” is the address valid on this network?";
        $("out").classList.remove("hidden");
      }
    }

    window.addEventListener("DOMContentLoaded", ()=>{
      try {
        const qs = new URLSearchParams(location.search);
        const mint = qs.get("mint") || localStorage.getItem("mintedMint") || "";
        if (mint) $("mint").value = mint;
      } catch {}
      $("check").onclick = handleCheck;
      $("toWizard").onclick = ()=>{
        const m = ($("mint").value||"").trim();
        if (!m) return alert("Enter a mint first.");
        localStorage.setItem("mintedMint", m);
        location.href = `/?mint=${m}&go=3`;
      };
    });
  </script>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-950 to-black text-slate-100">
  <div class="max-w-3xl mx-auto p-6">
    <header class="flex items-center justify-between">
      <h1 class="text-2xl font-extrabold">pump<span class="text-sky-400">.coin</span> <span class="text-xs align-super">Mint Guardian</span></h1>
      <div class="flex gap-2">
        <a href="/" class="px-3 py-2 rounded-xl border border-slate-700 text-sm">â† Wizard</a>
        <a href="/mint" class="px-3 py-2 rounded-xl border border-slate-700 text-sm">Mint</a>
      </div>
    </header>

    <section class="mt-6 bg-slate-900/40 border border-slate-800 rounded-2xl p-6">
      <h2 class="text-lg font-semibold">Safety Check</h2>
      <p class="text-sm text-slate-400">Quick grade on mint &amp; freeze authorities and whether metadata exists.</p>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mt-4">
        <label class="text-sm md:col-span-2">Token Mint
          <input id="mint" class="mt-1 w-full bg-slate-950 border border-slate-800 rounded-xl px-3 py-2" placeholder="Token mint address" />
        </label>
        <button id="check" class="mt-6 md:mt-auto px-4 py-2 rounded-xl bg-sky-500 hover:bg-sky-400 text-black font-semibold">Run Check</button>
      </div>

      <div id="gradeWrap" class="hidden mt-4 p-4 border border-slate-700 rounded-xl bg-slate-900/60">
        <div class="flex items-center gap-3">
          <span class="text-xs uppercase text-slate-400">Grade</span>
          <span id="badge" class="px-2 py-1 rounded-lg bg-slate-800 border border-slate-700 font-semibold"></span>
          <span id="note" class="text-sm text-slate-300"></span>
        </div>
        <div class="mt-3 text-xs">
          <a id="ex" class="underline" target="_blank">Open Mint in Explorer</a>
          <span class="mx-2 text-slate-600">â€¢</span>
          <a id="md" class="underline" target="_blank">Open Metadata PDA</a>
        </div>
      </div>

      <pre id="out" class="hidden mt-4 bg-slate-950 border border-slate-800 rounded-xl p-3 overflow-x-auto"></pre>

      <div class="mt-4">
        <button id="toWizard" class="px-4 py-2 rounded-xl bg-emerald-300 text-black font-semibold">Continue in Wizard (Step 3)</button>
      </div>

      <p class="text-xs text-slate-500 mt-3">
        Tip: After liquidity is live, renouncing mint <em>and</em> freeze authorities is common practice to reduce rug risk. Metadata should be set and stable.
      </p>
    </section>
  </div>
</body>
</html>

